<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ‰ Bingo Multijugador ðŸŽ‰</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(to bottom, #a03232, #430808);
    color: #000000;
    text-align: center;
    padding: 20px;
    position: relative;
    min-height: 100vh;
}

h1 {
    font-size: 36px;
    margin-bottom: 20px;
    color: #ffffff;
}

h2 {
    color: #ffffff; /* rojo mÃ¡s intenso para subtÃ­tulos */
}

#menu {
    margin-bottom: 20px;
}

button {
    padding:12px 25px;
    margin:5px;
    cursor:pointer;
    border:none;
    border-radius:10px;
    background-color:#e57373;
    color:white;
    font-weight:600;
    transition: 0.2s;
    font-size: 16px;
}

button:hover {
    background-color:#d32f2f;
}

#bingo-container, .tablero-amigo {
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    padding: 10px;
    border-radius: 15px;
    background: #fff;
    display: inline-block;
    margin-bottom: 20px;
}

table {
    margin:0 auto;
    border-collapse: collapse;
}

td {
    width:60px;
    height:60px;
    border:2px solid #b71c1c;
    text-align:center;
    vertical-align:middle;
    font-size:20px;
    cursor:pointer;
    transition: 0.2s;
    border-radius: 10px;
    background: #ffcdd2;
}

td:hover {
    background-color: #ef9a9a;
}

td.tachado {
    background-color: #b71c1c;
    color: white;
    text-decoration: line-through;
    transform: scale(1.1);
}

#tableros-amigos {
    display:none;
    margin-top:20px;
}

.tablero-amigo {
    display:inline-block;
    vertical-align:top;
    margin-right:20px;
}

.tablero-amigo h3 {
    margin-bottom:10px;
    font-size:18px;
}

#ranking {
    position:fixed;
    right:10px;
    top:50px;
    width:220px;
    text-align:left;
    background:#f9f9f9;
    padding:10px;
    border:1px solid #ccc;
    border-radius:5px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

#ranking h3 {
    margin-top:0;
    font-size:16px;
}

#mi-usuario {
    position:fixed;
    left:10px;
    top:10px;
    font-size:14px;
    background:#f0f0f0;
    padding:5px 10px;
    border-radius:5px;
    border:1px solid #ccc;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
</style>
</head>
<body>

<h1>ðŸŽ‰ Bingo Harem ðŸŽ‰</h1>

<div id="login">
    <input type="text" id="username" placeholder="Ingresa tu nombre">
    <button onclick="login()">âœ… Entrar</button>
</div>

<div id="menu" style="display:none;">
    <button onclick="mostrarTablero()">ðŸŽ² Mi tablero</button>
    <button onclick="verTablerosAmigos()">ðŸ‘€ Todos los tableros</button>
</div>

<div id="mi-usuario" style="display:none;"></div>

<div id="bingo-container"></div>

<div id="tableros-amigos">
    <h2>Tableros en vivo</h2>
    <div id="live-tableros"></div>
</div>

<div id="ranking">
    <h3>ðŸ“Š Puestos</h3>
    <ol id="lista-ganadores"></ol>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyAXUcVYxTy2aMSA2B4JWg9urqdggyDyQCg",
    authDomain: "bingoharem.firebaseapp.com",
    databaseURL: "https://bingoharem-default-rtdb.firebaseio.com",
    projectId: "bingoharem",
    storageBucket: "bingoharem.firebasestorage.app",
    messagingSenderId: "611013161474",
    appId: "1:611013161474:web:73d62328168934953c2d1b"
  };

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let usuario = '';
let miTablero = [];

function crearTableroInicial() {
    miTablero = [];
    while(miTablero.length < 25){
        let n = Math.floor(Math.random()*75)+1;
        if(!miTablero.some(e=>e.num===n)) miTablero.push({num:n, tachado:false});
    }
    miTablero[12].tachado = true;
    miTablero[12].num = "â˜…";
}

window.onload = function() {
    const nombreGuardado = localStorage.getItem('usuario');
    if(nombreGuardado){
        usuario = nombreGuardado;
        document.getElementById("login").style.display = "none";
        document.getElementById("menu").style.display = "block";
        mostrarTablero();
    } else {
        document.getElementById("login").style.display = "block";
    }
}

function login() {
    const input = document.getElementById("username");
    const nombreIngresado = input.value.trim();
    if(!nombreIngresado) return alert("Ingresa tu nombre");

    usuario = nombreIngresado;
    localStorage.setItem('usuario', usuario);

    db.ref('tableros/' + usuario).once('value').then(snapshot=>{
        if(!snapshot.exists()){
            crearTableroInicial();
            db.ref('tableros/'+usuario).set(miTablero);
        } else {
            const data = snapshot.val();
            miTablero = data.map(item => typeof item==='object' && item.num!==undefined ? item : {num:item, tachado:false});
        }
        document.getElementById("login").style.display = "none";
        document.getElementById("menu").style.display = "block";
        mostrarTablero();
    });
}

// --- Crear tabla ---
function crearTabla(container, tablero, editable=true){
    container.innerHTML="";
    const tabla = document.createElement("table");
    for(let i=0;i<5;i++){
        const fila = document.createElement("tr");
        for(let j=0;j<5;j++){
            const index = i*5+j;
            const celda = document.createElement("td");
            celda.textContent = tablero[index].num;
            if(tablero[index].tachado) celda.classList.add("tachado");
            if(editable && tablero[index].num !== "â˜…"){
                celda.addEventListener("click", ()=>{
                    tablero[index].tachado = !tablero[index].tachado;
                    db.ref('tableros/'+usuario).set(tablero);
                    actualizarLineas(usuario, tablero);
                });
            }
            fila.appendChild(celda);
        }
        tabla.appendChild(fila);
    }
    container.appendChild(tabla);
}

// --- Calcular lÃ­neas ---
function contarLineas(tablero){
    const matriz = [];
    for(let i=0;i<5;i++){
        matriz[i]=[];
        for(let j=0;j<5;j++){
            const idx=i*5+j;
            matriz[i][j]=tablero[idx].tachado || tablero[idx].num==="â˜…";
        }
    }
    let lineas=0;
    // Filas
    for(let i=0;i<5;i++) if(matriz[i].every(v=>v)) lineas++;
    // Columnas
    for(let j=0;j<5;j++) if([0,1,2,3,4].every(i=>matriz[i][j])) lineas++;
    // Diagonales
    if([0,1,2,3,4].every(i=>matriz[i][i])) lineas++;
    if([0,1,2,3,4].every(i=>matriz[i][4-i])) lineas++;
    return lineas;
}

// --- Actualizar ranking ---
function actualizarRanking(){
    db.ref('tableros').once('value').then(snapshot=>{
        const data = snapshot.val() || {};
        const rankingArray = [];
        for(const key in data){
            const lineas = contarLineas(data[key]);
            rankingArray.push({nombre:key, lineas:lineas});
        }
        // Orden descendente por lineas
        rankingArray.sort((a,b)=>b.lineas - a.lineas);
        const lista = document.getElementById("lista-ganadores");
        lista.innerHTML="";
        rankingArray.forEach((p)=>{
            const li=document.createElement("li");
            li.textContent=`${p.nombre}: ${p.lineas} lÃ­nea(s)`;
            lista.appendChild(li);
        });
    });
}

function actualizarLineas(user, tablero){
    // Guardar lÃ­neas en firebase opcionalmente si quieres
    actualizarRanking();
}

function mostrarTablero(){
    document.getElementById("tableros-amigos").style.display="none";
    document.getElementById("bingo-container").style.display="block";
    document.getElementById("mi-usuario").style.display="block";
    document.getElementById("mi-usuario").textContent = "Usuario: " + usuario;

    db.ref('tableros/' + usuario).on('value', snapshot=>{
        const data = snapshot.val();
        if(data){
            miTablero = data.map(item => typeof item==='object' && item.num!==undefined ? item : {num:item, tachado:false});
            crearTabla(document.getElementById("bingo-container"), miTablero, true);
            actualizarRanking();
        }
    });
}

function verTablerosAmigos(){
    document.getElementById("bingo-container").style.display="none";
    document.getElementById("mi-usuario").style.display="none";
    document.getElementById("tableros-amigos").style.display="block";
    const liveContainer = document.getElementById("live-tableros");
    liveContainer.innerHTML="";

    db.ref('tableros').once('value').then(snapshot=>{
        const data = snapshot.val() || {};
        for(const key in data){
            const div = document.createElement("div");
            div.className = "tablero-amigo";

            const h3 = document.createElement("h3");
            h3.textContent = key;
            div.appendChild(h3);

            const tablaContainer = document.createElement("div");
            div.appendChild(tablaContainer);
            liveContainer.appendChild(div);

            db.ref('tableros/'+key).on('value', snap=>{
                const tableroData = snap.val();
                if(tableroData){
                    crearTabla(tablaContainer, tableroData, false);
                }
            });
        }
    });
}

// Actualizar ranking cada segundo para reflejar cambios en vivo
setInterval(actualizarRanking, 1000);

</script>
</body>
</html>
